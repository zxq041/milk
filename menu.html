<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nasze Menu - MilkShake Bar</title>
  <meta name="description" content="Poznaj pełne menu MilkShake Bar. Wszystkie pozycje ładują się dynamicznie z systemu." />
  <meta name="keywords" content="menu, milkshake, bar, koktajle, desery, cennik" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    :root {
      --primary-color: #00A79D;
      --secondary-color: #FF6B6B;
      --accent-color: #F7C59F;
      --background-light: #FFF8E7;
      --background-dark: #003B46;
      --text-color-dark: #07575B;
      --text-color-light: #f5f5f5;
      --gradient-bg: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      --shadow: 0px 10px 30px rgba(0,0,0,0.1);
      --border-radius: 20px;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; font-size: 16px; }
    body { font-family: 'Poppins', sans-serif; color: var(--text-color-dark); background-color: var(--background-light); overflow-x: hidden; }
    .container { max-width: 1280px; margin: 0 auto; padding: 0 25px; }
    h1, h2, h3 { font-weight: 700; }
    h2.section-title { font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 900; margin-bottom: 30px; text-align: center; background: var(--gradient-bg); -webkit-background-clip: text; -webkit-text-fill-color: transparent; position: relative; }

    .header { position: sticky; top:0; left:0; width:100%; padding:20px 0; z-index: 1000; transition: .3s; background: rgba(255,248,231,.85); backdrop-filter: blur(10px); box-shadow: 0 4px 15px rgba(0,0,0,.05); }
    .navbar { display:flex; justify-content:space-between; align-items:center; }
    .logo { display:flex; align-items:center; text-decoration:none; font-weight:700; font-size:1.5rem; color:var(--primary-color); }
    .logo img{ width:50px; height:50px; border-radius:50%; margin-right:15px; transition: transform .4s cubic-bezier(.175,.885,.32,1.275); }
    .logo:hover img{ transform: rotate(360deg) scale(1.1); }
    .nav-menu { list-style:none; display:flex; align-items:center; }
    .nav-item { margin: 0 20px; }
    .nav-link { color:var(--text-color-dark); text-decoration:none; font-weight:600; position:relative; padding:5px 0; }
    .nav-link::after{ content:''; position:absolute; bottom:-5px; left:0; width:100%; height:3px; background:var(--gradient-bg); border-radius:2px; transform:scaleX(0); transform-origin:right; transition:transform .4s cubic-bezier(.19,1,.22,1); }
    .nav-link:hover::after, .nav-link.active::after{ transform:scaleX(1); transform-origin:left; }
    .btn { padding:14px 30px; border-radius:50px; font-weight:600; text-decoration:none; cursor:pointer; transition:.3s; border:none; display:inline-flex; align-items:center; gap:10px; }
    .btn-primary { background:var(--gradient-bg); color:white; box-shadow:0 4px 20px rgba(0,167,157,.4); }
    .btn-primary:hover { transform: translateY(-5px); box-shadow:0 8px 25px rgba(0,167,157,.6); }
    .hamburger{ display:none; }

    .section { padding: 80px 0 120px; position: relative; }

    .toolbar { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin: 10px 0 30px; }
    .toolbar input, .toolbar select { padding:12px 16px; border:2px solid #e0e0e0; border-radius:12px; font: inherit; }

    .menu-category-title { font-size:2rem; font-weight:700; margin: 50px 0 20px; border-bottom:3px solid var(--primary-color); padding-bottom:10px; display:inline-block; }
    .menu-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 28px; }
    .menu-card { background:#fff; border-radius: var(--border-radius); box-shadow: var(--shadow); overflow:hidden; position:relative; transition: transform .35s cubic-bezier(.175,.885,.32,1.275), box-shadow .35s; }
    .menu-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,.12); }
    .menu-card-image{ height:220px; overflow:hidden; }
    .menu-card-image img{ width:100%; height:100%; object-fit:cover; transition: transform .5s; }
    .menu-card:hover .menu-card-image img{ transform: scale(1.07); }
    .menu-card-content{ padding: 22px; }
    .menu-card h3{ font-size: 1.4rem; margin-bottom: 6px; }
    .menu-card p{ font-size: .98rem; line-height:1.6; opacity:.9; min-height: 48px; }
    .menu-card .meta{ display:flex; justify-content:space-between; align-items:center; margin-top: 12px; }
    .price{ font-size: 1.6rem; font-weight:900; background: var(--gradient-bg); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .badge{ display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700; font-size:.8rem; color:#fff; }
    .badge.gray{ background:#95a5a6; }
    .badge.green{ background:#27ae60; }
    .card-disabled{ filter: grayscale(1); opacity:.7; }

    .footer{ background-color: var(--background-dark); color:#ccc; padding:80px 0 40px; }
    .footer-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:40px; margin-bottom:50px; }
    .footer-col h4{ font-size:1.4rem; color:#fff; margin-bottom:25px; position:relative; }
    .footer-col h4::after{ content:''; position:absolute; bottom:-10px; left:0; width:50px; height:3px; background:var(--gradient-bg); border-radius:2px; }
    .footer-col .logo{ margin-bottom:20px; }
    .footer-col p, .footer-col li{ font-size:.95rem; line-height:1.8; }
    .footer-col ul{ list-style:none; }
    .footer-col li{ margin-bottom:10px; }
    .footer-col a{ color:#ccc; text-decoration:none; transition: color .3s, padding-left .3s; }
    .footer-col a:hover{ color:var(--text-color-light); padding-left:5px; }
    .footer-socials{ display:flex; gap:15px; }
    .footer-socials a{ width:40px; height:40px; display:flex; justify-content:center; align-items:center; background: rgba(255,255,255,.1); color:#fff; border-radius:50%; text-decoration:none; transition: background-color .3s, transform .3s; }
    .footer-socials a:hover{ background: var(--primary-color); transform: translateY(-5px); }
    .footer-bottom{ text-align:center; border-top:1px solid rgba(255,255,255,.1); padding-top:30px; font-size:.9rem; opacity:.8; }

    @media(max-width: 992px){
      .nav-menu{ position:fixed; top:0; right:-100%; width:70%; height:100vh; background: white; box-shadow:-10px 0 30px rgba(0,0,0,.1); flex-direction:column; justify-content:center; gap:40px; transition:right .5s cubic-bezier(.77,0,.175,1); }
      .nav-menu.active{ right:0; }
      .nav-link{ font-size:1.5rem; }
      .hamburger{ display:block; z-index:1001; cursor:pointer; }
      .btn-primary.nav-btn{ display:none; }
    }
    @media(max-width:768px){ .footer-grid{ text-align:center; } .footer-col h4::after{ left: 50%; transform: translateX(-50%); } .footer-socials{ justify-content:center; } }
  </style>
</head>
<body>
  <header class="header" id="header">
    <div class="container">
      <nav class="navbar">
        <a href="index.html" class="logo"><img src="https://i.imgur.com/Twr2Rms.jpeg" alt="Logo MilkShake Bar" /><span>MilkShake Bar</span></a>
        <ul class="nav-menu">
          <li class="nav-item"><a href="index.html#about" class="nav-link">O nas</a></li>
          <li class="nav-item"><a href="menu.html" class="nav-link active">Menu</a></li>
          <li class="nav-item"><a href="index.html#location" class="nav-link">Lokal</a></li>
        </ul>
        <a href="index.html#reservation" class="btn btn-primary nav-btn">Rezerwacja</a>
        <div class="hamburger"><i class="fas fa-bars fa-2x"></i></div>
      </nav>
    </div>
  </header>

  <main>
    <section id="full-menu" class="section">
      <div class="container">
        <h2 class="section-title">Nasze Pełne Menu</h2>

        <div class="toolbar">
          <input id="search" type="text" placeholder="Szukaj po nazwie lub opisie..." />
          <select id="category"></select>
        </div>

        <div id="menu-root"></div>

        <div id="loader" style="text-align:center; padding:40px;">
          <i class="fa-solid fa-spinner fa-spin"></i> Ładowanie pozycji...
        </div>
        <div id="error" style="display:none; text-align:center; padding:40px; color:#e74c3c; font-weight:700;"></div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-col">
          <a href="index.html" class="logo"><img src="https://i.imgur.com/Twr2Rms.jpeg" alt="Logo MilkShake Bar" /><span>MilkShake Bar</span></a>
          <p>Zanurz się w świecie kremowej perfekcji, gdzie każdy koktajl to dzieło sztuki.</p>
        </div>
        <div class="footer-col">
          <h4>Nawigacja</h4>
          <ul>
            <li><a href="index.html#about">O nas</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="index.html#gallery">Galeria</a></li>
            <li><a href="index.html#reservation">Rezerwacja</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Kontakt</h4>
          <ul>
            <li><i class="fas fa-map-marker-alt"></i> Szczecińska 17, 76-200 Słupsk</li>
            <li><i class="fas fa-phone"></i> +48 733 033 100</li>
            <li><i class="fas fa-clock"></i> Otwarte: Pn-Sb 12-22, Nd 12-21</li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Znajdź nas</h4>
          <div class="footer-socials">
            <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom"><p>© 2025 MilkShake Bar. Wszystkie prawa zastrzeżone.</p></div>
    </div>
  </footer>

  <script>
    const API_URL = `${location.origin}/api`;
    const MENU_CATEGORIES = ['Shakes klasyczne','Shakes premium','Owocowe','Desery','Napoje','Kawa/Herbata','Dodatki','Inne'];

    const fmt = (n) => (isNaN(n) ? '0.00' : Number(n).toFixed(2));

    const el = (sel) => document.querySelector(sel);
    const root = () => el('#menu-root');
    const loader = () => el('#loader');
    const errorBox = () => el('#error');

    const apiFetch = async (endpoint, opts={}) => {
      try {
        const res = await fetch(`${API_URL}${endpoint}`, opts);
        if (!res.ok) throw new Error((await res.json().catch(()=>({}))).message || 'Błąd serwera');
        if (res.status === 204) return null;
        return res.json();
      } catch (e) {
        throw e;
      }
    };

    const populateFilters = (items) => {
      const select = el('#category');
      select.innerHTML = '';
      const all = document.createElement('option'); all.value = ''; all.textContent = 'Wszystkie kategorie'; select.appendChild(all);
      const cats = Array.from(new Set(items.map(i => i.category).filter(Boolean)));
      const ordered = [...MENU_CATEGORIES.filter(c => cats.includes(c)), ...cats.filter(c => !MENU_CATEGORIES.includes(c))];
      ordered.forEach(c => { const o = document.createElement('option'); o.value = c; o.textContent = c; select.appendChild(o); });
    };

    const groupByCategory = (items) => {
      const map = new Map();
      const order = (a,b) => {
        const ia = MENU_CATEGORIES.indexOf(a); const ib = MENU_CATEGORIES.indexOf(b);
        return (ia === -1 ? 999 : ia) - (ib === -1 ? 999 : ib);
      };
      items.forEach(it => {
        const c = it.category || 'Inne';
        if (!map.has(c)) map.set(c, []);
        map.get(c).push(it);
      });
      return new Map([...map.entries()].sort((a,b) => order(a[0], b[0])));
    };

    const card = (it) => `
      <article class="menu-card ${it.isAvailable ? '' : 'card-disabled'}" aria-label="${it.name}">
        <div class="menu-card-image">
          <img src="${it.imageUrl || 'https://placehold.co/800x600?text=MilkShake+Bar'}" alt="${it.name}" loading="lazy" />
        </div>
        <div class="menu-card-content">
          <h3>${it.name}</h3>
          <p>${it.description || ''}</p>
          <div class="meta">
            <span class="price">${fmt(it.price)} PLN</span>
            <span class="badge ${it.isAvailable ? 'green' : 'gray'}">${it.isAvailable ? 'Dostępne' : 'Niedostępne'}</span>
          </div>
        </div>
      </article>`;

    const section = (category, items) => `
      <h3 class="menu-category-title" id="cat-${encodeURIComponent(category)}">${category}</h3>
      <div class="menu-grid">${items.map(card).join('')}</div>`;

    const render = (items) => {
      if (!items.length) {
        root().innerHTML = '<div style="text-align:center; padding:40px;">Brak pozycji w menu.</div>';
        return;
      }
      const groups = groupByCategory(items);
      const html = [...groups.entries()].map(([cat, list]) => section(cat, list)).join('');
      root().innerHTML = html;
    };

    const applyFilters = (base) => {
      const q = (el('#search').value || '').toLowerCase();
      const cat = el('#category').value || '';
      const filtered = base.filter(it => {
        const matchQ = !q || (it.name?.toLowerCase().includes(q) || it.description?.toLowerCase().includes(q));
        const matchC = !cat || it.category === cat;
        return matchQ && matchC;
      });
      render(filtered);
    };

    document.addEventListener('DOMContentLoaded', async () => {
      // Mobile nav
      const hamburger = document.querySelector('.hamburger');
      const navMenu = document.querySelector('.nav-menu');
      if (hamburger) hamburger.addEventListener('click', () => navMenu.classList.toggle('active'));

      try {
        const items = await apiFetch('/menu');
        const arr = Array.isArray(items) ? items : [];
        populateFilters(arr);
        render(arr);
        loader().style.display = 'none';

        el('#search').addEventListener('input', () => applyFilters(arr));
        el('#category').addEventListener('change', () => applyFilters(arr));

        // Głębokie linkowanie do kategorii: menu.html#cat=Napoje
        if (location.hash.startsWith('#cat=')) {
          const target = document.getElementById(`cat-${decodeURIComponent(location.hash.slice(5))}`);
          if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      } catch (e) {
        loader().style.display = 'none';
        errorBox().style.display = 'block';
        errorBox().textContent = e.message || 'Nie udało się załadować menu.';
      }
    });
  </script>
</body>
</html>
