<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MilkShake Bar | Nowoczesny Wymiar Smaku</title>
    <style>
        /* ... wszystkie style bez zmian ... */
    </style>
</head>
<body>
    <header></header>
    <main></main>
    <footer></footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const dateInput = document.getElementById('date');
        const allTables = document.querySelectorAll('#seating-map .table');
        const selectedSeatDisplay = document.getElementById('selected-seat-display');
        const selectedSeatValue = document.getElementById('selected-seat-value');
        const bookingForm = document.getElementById('bookingForm');

        if(dateInput) { dateInput.setAttribute('min', new Date().toISOString().split('T')[0]); }
        
        const fetchTableAvailability = async () => {
            const selectedDate = dateInput.value;
            if (!selectedDate) return;
            try {
                const response = await fetch(`/api/reservations?date=${selectedDate}`);
                if (!response.ok) throw new Error('Błąd serwera');
                const reservations = await response.json();
                const reservedTableIds = reservations.map(r => r.tableId);

                allTables.forEach(table => {
                    table.classList.remove('available', 'unavailable', 'selected');
                    if (reservedTableIds.includes(table.id)) {
                        table.classList.add('unavailable');
                    } else {
                        table.classList.add('available');
                    }
                });
                selectedSeatDisplay.value = "Najpierw wybierz miejsce na mapie";
                selectedSeatValue.value = "";
            } catch (error) { console.error("Błąd podczas sprawdzania dostępności:", error); }
        };
        if(dateInput) { dateInput.addEventListener('change', fetchTableAvailability); }
        
        allTables.forEach(table => {
            table.addEventListener('click', () => {
                if(table.classList.contains('unavailable')) return;
                allTables.forEach(t => t.classList.remove('selected'));
                table.classList.add('selected');
                selectedSeatDisplay.value = `Wybrano: ${table.dataset.name}`;
                selectedSeatValue.value = table.id;
            });
        });

        bookingForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!selectedSeatValue.value) {
                alert('Proszę wybrać miejsce na mapie.');
                return;
            }
            const formData = new FormData(bookingForm);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/api/reservations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert(result.message);
                if (response.ok) {
                    bookingForm.reset();
                    fetchTableAvailability();
                }
            } catch (error) {
                alert('Wystąpił błąd. Spróbuj ponownie.');
            }
        });
        
        if(dateInput) { fetchTableAvailability(); }
        // ... reszta skryptu (animacje, menu mobilne) bez zmian
    });
    </script>
</body>
</html>
