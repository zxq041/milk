<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MilkShake System 1.0</title>
    <meta name="description" content="System do zarządzania Twoim biznesem.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        :root {
            --primary-color: #00A79D;
            --secondary-color: #FF6B6B;
            --accent-color: #F7C59F;
            --background-light: #FFF8E7;
            --background-dark: #003B46;
            --text-color-dark: #07575B;
            --text-color-light: #f5f5f5;
            --gradient-bg: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --shadow: 0px 10px 30px rgba(0, 0, 0, 0.1);
            --border-radius: 20px;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--text-color-dark);
            background-color: var(--background-light);
            overflow-x: hidden;
        }

        .admin-wrapper { display: flex; min-height: 100vh; }

        .sidebar {
            width: 280px;
            flex-shrink: 0;
            background-color: var(--background-dark);
            color: var(--text-color-light);
            display: flex;
            flex-direction: column;
            padding: 20px;
            transition: transform 0.3s ease-in-out;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            margin-bottom: 30px;
        }

        .sidebar-header img { width: 50px; height: 50px; border-radius: 12px; }
        .sidebar-header .title-block { line-height: 1.2; }
        .sidebar-header .title { font-weight: 700; font-size: 1.2rem; color: #fff; }
        .sidebar-header .subtitle { font-size: 0.8rem; opacity: 0.7; }

        .sidebar-nav { list-style: none; flex-grow: 1; }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 20px;
            margin-bottom: 10px;
            border-radius: 12px;
            text-decoration: none;
            color: var(--text-color-light);
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-link:hover { background-color: rgba(255, 255, 255, 0.1); }
        .nav-link.active {
            background: var(--gradient-bg);
            color: #fff;
            box-shadow: 0 4px 20px rgba(0, 167, 157, 0.4);
            transform: scale(1.02);
        }
        .nav-link i { width: 20px; text-align: center; }
        
        .main-content { flex-grow: 1; padding: 40px; overflow-y: auto; }
        .main-header { display: none; align-items: center; gap: 20px; margin-bottom: 20px; }

        .menu-toggle-btn {
            background: #fff;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            box-shadow: var(--shadow);
            color: var(--primary-color);
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .section-title {
            font-size: clamp(2rem, 4vw, 2.5rem);
            font-weight: 900;
            margin-bottom: 30px;
            background: var(--gradient-bg);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .section-header .section-title { margin: 0; }

        .card { background: #fff; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 25px; }
        
        .btn {
            padding: 14px 30px;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary { background: var(--gradient-bg); color: white; box-shadow: 0 4px 20px rgba(0, 167, 157, 0.4); }
        .btn-primary:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0, 167, 157, 0.6); }
        .btn-secondary { background: #eee; color: var(--text-color-dark); }
        .btn-secondary:hover { background: #ddd; }

        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; }
        
        .category-tile {
            background: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
            text-decoration: none;
            color: var(--text-color-dark);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 150px;
        }
        
        .category-tile:hover {
            transform: translateY(-10px);
            box-shadow: 0px 15px 35px rgba(0, 0, 0, 0.15);
            border: 2px solid var(--primary-color);
            padding: 18px;
        }
        
        .category-tile h3 { font-size: 1.5rem; font-weight: 700; margin-bottom: 5px; }
        .category-tile span { font-size: 0.9rem; color: var(--primary-color); font-weight: 600; }

        /* ... [reszta Twojego CSS bez zmian] ... */

    </style>
</head>
<body>
    <div class="admin-wrapper">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="https://i.imgur.com/EV2m6BO.jpeg" alt="logo">
                <div class="title-block">
                    <div class="title">MilkShake System</div>
                    <div class="subtitle">Wersja 1.0</div>
                </div>
            </div>
            
            <nav id="main-nav" class="sidebar-nav">
                <a href="#nowe-zamowienie" class="nav-link active"><i class="fas fa-plus-circle"></i><span>Nowe Zamówienie</span></a>
                <a href="#zamowienia" class="nav-link"><i class="fas fa-clipboard-list"></i><span>Zamówienia</span></a>
                <a href="#rezerwacje" class="nav-link"><i class="fas fa-calendar-alt"></i><span>Rezerwacje</span></a>
                <a href="#pracownicy" class="nav-link"><i class="fas fa-users"></i><span>Pracownicy</span></a>
                <a href="#produkty" class="nav-link"><i class="fas fa-box-open"></i><span>Produkty</span></a>
                <a href="#finanse" class="nav-link"><i class="fas fa-dollar-sign"></i><span>Finanse</span></a>
                <a href="#aktywnosc" class="nav-link"><i class="fas fa-chart-line"></i><span>Aktywność</span></a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <button id="menu-toggle" class="menu-toggle-btn"><i class="fas fa-bars"></i></button>
                <h1 id="page-title" class="section-title" style="margin: 0; font-size: 1.5rem;"></h1>
            </header>

            <div id="content-nowe-zamowienie" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Nowe Zamówienie</h1>
                </div>
                <p style="margin-bottom: 30px;">Wybierz kategorię, aby rozpocząć kompletowanie zamówienia.</p>
                <div id="category-list" class="grid-container">
                    </div>
            </div>

            <div id="content-order-products" class="content-section" style="display: none;">
                 </div>
             
             <div id="content-order-summary" class="content-section" style="display: none;">
                </div>

            <div id="content-zamowienia" class="content-section" style="display: none;">
                <h1 class="section-title">Historia Zamówień</h1>
                <div id="orders-list"></div>
            </div>

            <div id="content-pracownicy" class="content-section" style="display: none;">
                <div class="section-header">
                    <h1 class="section-title">Lista pracowników</h1>
                    <button id="add-employee-btn" class="btn btn-primary"><i class="fas fa-plus"></i><span>Dodaj pracownika</span></button>
                </div>
                <div id="employees-list" class="card"></div>
            </div>

            <div id="content-produkty" class="content-section" style="display: none;">
                <div class="section-header">
                    <h1 class="section-title">Lista produktów</h1>
                    <button id="add-product-btn" class="btn btn-primary"><i class="fas fa-plus"></i><span>Dodaj produkt</span></button>
                </div>
                <div id="products-list" class="grid-container"></div>
            </div>

        </main>
    </div>
    
    <div id="add-product-modal" class="modal"> </div>
    <div id="add-employee-modal" class="modal"> </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ========== KONFIGURACJA ==========
        const API_URL = 'http://localhost:3000/api'; // Zmień na adres serwera po wdrożeniu

        // ========== SELEKTORY DOM ==========
        const sidebar = document.getElementById('sidebar');
        const menuToggleBtn = document.getElementById('menu-toggle');
        const pageTitle = document.getElementById('page-title');
        const mainNav = document.getElementById('main-nav');
        const contentSections = document.querySelectorAll('.content-section');
        const navLinks = document.querySelectorAll('.nav-link');

        // ========== STAN APLIKACJI ==========
        let currentOrder = []; // Koszyk na aktualne zamówienie

        // ========== FUNKCJE POMOCNICZE ==========
        
        /**
         * Funkcja do wysyłania zapytań do API
         * @param {string} endpoint - np. '/produkty'
         * @param {object} options - Opcje dla fetch(), np. method, headers, body
         */
        const apiFetch = async (endpoint, options = {}) => {
            try {
                const response = await fetch(`${API_URL}${endpoint}`, options);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Błąd serwera');
                }
                return response.json();
            } catch (error) {
                console.error(`Błąd API dla ${endpoint}:`, error);
                alert(`Wystąpił błąd: ${error.message}`);
                return null;
            }
        };

        // ========== LOGIKA NAWIGACJI (Single Page Application) ==========
        const navigateTo = (hash) => {
            const cleanHash = hash ? hash.substring(1) : 'nowe-zamowienie';
            
            contentSections.forEach(section => section.style.display = 'none');
            
            let activeSection = document.getElementById(`content-${cleanHash}`);
            if (activeSection) {
                activeSection.style.display = 'block';
            } else {
                document.getElementById('content-nowe-zamowienie').style.display = 'block';
            }
            
            navLinks.forEach(link => {
                link.classList.toggle('active', link.getAttribute('href') === hash);
            });
            
            // Renderowanie odpowiedniej zawartości dla sekcji
            switch(cleanHash) {
                case 'nowe-zamowienie': renderOrderCategories(); break;
                case 'zamowienia': renderOrdersHistory(); break;
                case 'pracownicy': renderEmployees(); break;
                case 'produkty': renderAllProducts(); break;
            }
            
            if(window.innerWidth <= 800) sidebar.classList.remove('is-open');
        };
        
        // ========== RENDEROWANIE DANYCH ==========

        // --- Nowe Zamówienie ---
        const renderOrderCategories = async () => {
            const products = await apiFetch('/produkty');
            if (!products) return;
            
            const categories = [...new Set(products.map(p => p.category))]; // Unikalne kategorie
            const categoryListContainer = document.getElementById('category-list');
            categoryListContainer.innerHTML = '';
            
            categories.forEach(cat => {
                const tile = document.createElement('a');
                tile.className = 'category-tile';
                tile.innerHTML = `<h3>${cat}</h3>`;
                tile.onclick = () => showProductSwiperForCategory(cat);
                categoryListContainer.appendChild(tile);
            });
        };

        const showProductSwiperForCategory = async (categoryName) => {
            // Tutaj zaimplementujesz logikę widoku "Tindera"
            // Na razie jako placeholder:
            const products = await apiFetch(`/produkty/kategoria/${categoryName}`);
            const container = document.getElementById('content-order-products');
            container.innerHTML = `<h1 class="section-title">${categoryName}</h1>
                                   <p>Tu będzie interfejs do zamawiania (przesuwanie produktów).</p>
                                   <div class="grid-container">
                                        ${products.map(p => `<div class="card">${p.name} - <input type="number" placeholder="Ilość"></div>`).join('')}
                                   </div>
                                   <button class="btn btn-primary" onclick="showOrderSummary()">Podsumowanie</button>`;
            navigateTo('#order-products');
        };

        const showOrderSummary = () => {
            // Tutaj logika podsumowania zamówienia
            const container = document.getElementById('content-order-summary');
            container.innerHTML = `<h1 class="section-title">Podsumowanie</h1>
                                   <p>Tu będzie lista zamówionych produktów z koszyka 'currentOrder'.</p>
                                   <button class="btn btn-primary">Złóż zamówienie</button>`;
            navigateTo('#order-summary');
        };

        // --- Historia Zamówień ---
        const renderOrdersHistory = async () => {
            const orders = await apiFetch('/zamowienia');
            const container = document.getElementById('orders-list');
            if (!orders) {
                container.innerHTML = '<p>Brak historii zamówień.</p>';
                return;
            }
            container.innerHTML = orders.map(order => `
                <div class="card">
                    <h4>Zamówienie z dnia: ${new Date(order.createdAt).toLocaleString('pl-PL')}</h4>
                    <p><b>Status:</b> ${order.status}</p>
                    <p><b>Wartość:</b> ${order.totalPrice.toFixed(2)} PLN</p>
                    <ul>
                        ${order.items.map(item => `<li>${item.name} - ${item.quantity} ${item.unit}</li>`).join('')}
                    </ul>
                </div>
            `).join('');
        };
        
        // --- Pracownicy ---
        const renderEmployees = async () => {
            const employees = await apiFetch('/pracownicy');
            const container = document.getElementById('employees-list');
            if (!employees || employees.length === 0) {
                container.innerHTML = '<p>Brak pracowników w systemie.</p>';
                return;
            }
            container.innerHTML = employees.map(user => `
                <div class="employee-item">
                    <div class="employee-item-name">${user.name} (${user.position})</div>
                    <div class="employee-item-details">
                        <span>Stawka: <b>${user.hourlyRate.toFixed(2)} zł/h</b></span>
                        <button data-user-id="${user._id}" class="btn btn-secondary edit-employee-btn">
                            <i class="fas fa-pencil-alt"></i> Edytuj
                        </button>
                    </div>
                </div>
            `).join('');
        };

        // --- Produkty ---
        const renderAllProducts = async () => {
            const products = await apiFetch('/produkty');
            const container = document.getElementById('products-list');
            if (!products || products.length === 0) {
                container.innerHTML = '<p>Brak produktów w systemie.</p>';
                return;
            }
            container.innerHTML = products.map(prod => `
                <div class="card product-card">
                    <img src="${prod.imageUrl}" alt="${prod.name}">
                    <div class="product-card-content">
                        <h3 class="product-card-name">${prod.name}</h3>
                        <p>${prod.category}</p>
                        <div class="product-card-price">${prod.pricePerUnit.toFixed(2)} PLN / ${prod.unit}</div>
                    </div>
                </div>
            `).join('');
        };
        
        // ========== OBSŁUGA FORMULARZY I MODALI ==========
        
        const setupModal = (modalId, openBtnId, cancelBtnId, formId, submitFunction) => {
            const modal = document.getElementById(modalId);
            const openBtn = document.getElementById(openBtnId);
            const cancelBtn = document.getElementById(cancelBtnId);
            const form = document.getElementById(formId);

            openBtn.addEventListener('click', () => modal.style.display = 'flex');
            cancelBtn.addEventListener('click', () => modal.style.display = 'none');
            
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                
                // Konwertuj stringi na liczby tam gdzie trzeba
                if(data.hourlyRate) data.hourlyRate = parseFloat(data.hourlyRate);
                if(data.pricePerUnit) data.pricePerUnit = parseFloat(data.pricePerUnit);

                await submitFunction(data);
                
                modal.style.display = 'none';
                form.reset();
            });
        };

        // Inicjalizacja modali
        setupModal('add-employee-modal', 'add-employee-btn', 'cancel-add-employee', 'add-employee-form', async (data) => {
            await apiFetch('/pracownicy', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            renderEmployees(); // Odśwież listę
        });
        
        setupModal('add-product-modal', 'add-product-btn', 'cancel-add-product', 'add-product-form', async (data) => {
            await apiFetch('/produkty', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            renderAllProducts(); // Odśwież listę
        });

        // ========== INICJALIZACJA APLIKACJI ==========
        mainNav.addEventListener('click', (e) => {
            const link = e.target.closest('a');
            if (link) {
                e.preventDefault();
                window.location.hash = link.getAttribute('href');
            }
        });
        
        window.addEventListener('hashchange', () => navigateTo(window.location.hash));
        menuToggleBtn.addEventListener('click', () => sidebar.classList.toggle('is-open'));

        // Inicjalizacja widoku na podstawie aktualnego hasha lub domyślnego
        navigateTo(window.location.hash || '#nowe-zamowienie');
    });
    </script>
</body>
</html>
