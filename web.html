<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MilkShake System 1.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* ... (CAŁY TWÓJ KOD CSS BEZ ZMIAN) ... */
        :root{--primary-color:#00A79D;--secondary-color:#FF6B6B;--background-light:#FFF8E7;--background-dark:#003B46;--text-color-dark:#07575B;--text-color-light:#f5f5f5;--gradient-bg:linear-gradient(135deg,var(--primary-color),var(--secondary-color));--shadow:0 10px 30px rgba(0,0,0,.1);--border-radius:20px}*,::after,::before{box-sizing:border-box;margin:0;padding:0}html{scroll-behavior:smooth}body{font-family:'Poppins',sans-serif;color:var(--text-color-dark);background-color:var(--background-light);overflow-x:hidden}.admin-wrapper{display:flex;min-height:100vh}.sidebar{width:280px;flex-shrink:0;background-color:var(--background-dark);color:var(--text-color-light);display:flex;flex-direction:column;padding:20px;transition:transform .3s ease-in-out}.sidebar-header{display:flex;align-items:center;gap:15px;padding:10px;margin-bottom:30px}.sidebar-header img{width:50px;height:50px;border-radius:12px}.sidebar-header .title-block{line-height:1.2}.sidebar-header .title{font-weight:700;font-size:1.2rem;color:#fff}.sidebar-header .subtitle{font-size:.8rem;opacity:.7}.sidebar-nav{list-style:none;flex-grow:1}.nav-link{display:flex;align-items:center;gap:15px;padding:18px 20px;margin-bottom:10px;border-radius:12px;text-decoration:none;color:var(--text-color-light);font-weight:600;transition:all .3s ease}.nav-link:hover{background-color:rgba(255,255,255,.1)}.nav-link.active{background:var(--gradient-bg);color:#fff;box-shadow:0 4px 20px rgba(0,167,157,.4);transform:scale(1.02)}.nav-link i{width:20px;text-align:center}.main-content{flex-grow:1;padding:40px;overflow-y:auto;display:flex;flex-direction:column}.main-header{display:none;align-items:center;gap:20px;margin-bottom:20px}.menu-toggle-btn{background:#fff;border:none;width:50px;height:50px;border-radius:50%;box-shadow:var(--shadow);color:var(--primary-color);font-size:1.2rem;cursor:pointer}.section-title{font-size:clamp(2rem,4vw,2.5rem);font-weight:900;margin-bottom:30px;background:var(--gradient-bg);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        /* Style dla widoku logowania */
        #login-view{display:flex;align-items:center;justify-content:center;width:100vw;height:100vh}.login-card{background:#fff;padding:40px;border-radius:var(--border-radius);box-shadow:var(--shadow);text-align:center;width:100%;max-width:400px}.login-card img{width:80px;height:80px;border-radius:12px;margin-bottom:20px}.title{font-weight:700;font-size:1.5rem;color:var(--text-color-dark)}.subtitle{font-size:.9rem;opacity:.7;margin-bottom:30px}#login-form{display:flex;flex-direction:column}#login-input{width:100%;padding:15px;border:2px solid #e0e0e0;border-radius:12px;font-family:'Poppins',sans-serif;font-size:1rem;margin-bottom:20px;text-align:center}#login-input:focus{outline:none;border-color:var(--primary-color)}#login-button{padding:15px;border-radius:50px;font-weight:600;cursor:pointer;transition:all .3s ease;border:none;background:var(--primary-color);color:#fff}#login-button:hover{transform:translateY(-3px)}#error-message{color:#e74c3c;margin-top:15px;display:none;font-weight:600}
    </style>
</head>
<body>

    <div id="login-view" style="display: none;">
        <div class="login-card">
            <img src="https://i.imgur.com/EV2m6BO.jpeg" alt="logo">
            <div class="title">MilkShake System</div>
            <div class="subtitle">Wersja 1.0</div>
            <form id="login-form">
                <input type="text" id="login-input" placeholder="Wprowadź swój login" required>
                <button type="submit" id="login-button">Zaloguj się</button>
            </form>
            <div id="error-message"></div>
        </div>
    </div>

    <div class="admin-wrapper" style="display: none;">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="https://i.imgur.com/EV2m6BO.jpeg" alt="logo">
                <div class="title-block">
                    <div id="user-name" class="title"></div>
                    <div class="subtitle">Zalogowany</div>
                </div>
            </div>
            <nav id="main-nav" class="sidebar-nav">
                 <a href="#nowe-zamowienie" class="nav-link active"><i class="fas fa-plus-circle"></i><span>Nowe Zamówienie</span></a>
                 <a href="#zamowienia" class="nav-link"><i class="fas fa-clipboard-list"></i><span>Zamówienia</span></a>
                 <a href="#pracownicy" class="nav-link"><i class="fas fa-users"></i><span>Pracownicy</span></a>
                 <a href="#produkty" class="nav-link"><i class="fas fa-box-open"></i><span>Produkty</span></a>
            </nav>
            <div class="sidebar-footer" style="padding: 20px 0; margin-top: auto;">
                <a href="#" id="logout-btn" class="nav-link" style="background-color: rgba(255, 107, 107, 0.1); color: #FF6B6B;">
                    <i class="fas fa-sign-out-alt"></i><span>Wyloguj się</span>
                </a>
            </div>
        </aside>
        <main class="main-content">
            </main>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const loginView = document.getElementById('login-view');
        const appView = document.querySelector('.admin-wrapper');
        const loginForm = document.getElementById('login-form');
        const loginInput = document.getElementById('login-input');
        const errorMessage = document.getElementById('error-message');
        let loggedInUser = null;

        // GŁÓWNA FUNKCJA URUCHAMIAJĄCA APLIKACJĘ PO ZALOGOWANIU
        const initializeApp = (user) => {
            loggedInUser = user;
            
            // Ukryj logowanie, pokaż aplikację
            loginView.style.display = 'none';
            appView.style.display = 'flex';

            document.getElementById('user-name').textContent = user.name;

            // Tutaj wklejamy cały poprzedni kod JavaScript, który obsługiwał aplikację
            const API_URL = `${window.location.origin}/api`;
            const STATIC_CATEGORIES = [ { name: 'Mroźnia 1', desc: '(Frytki)' }, { name: 'Mroźnia 2', desc: '(Bar)' }, { name: 'Mroźnia 3', desc: '(Mięso)' }, { name: 'Mroźnia 4', desc: '(Produkty)' }, { name: 'Chłodnia', desc: '' }, { name: 'Magazyn Suchy', desc: '' }, { name: 'Magazyn Suchy', desc: '(Bar)' }, { name: 'Opakowania', desc: '' }, { name: 'Warzywa i Owoce', desc: '' }, { name: 'Mix', desc: '' } ];
            let shoppingCart = [];
            const sidebar = document.getElementById('sidebar'), menuToggleBtn = document.getElementById('menu-toggle'), mainNav = document.getElementById('main-nav'), contentSections = document.querySelectorAll('.content-section'), navLinks = document.querySelectorAll('.nav-link'), categoryListContainer = document.getElementById('category-list'), productsListContainer = document.getElementById('products-list');
            const apiFetch = async (endpoint, options = {}) => { try { const response = await fetch(`${API_URL}${endpoint}`, options); if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.message || 'Błąd serwera'); } if (response.status === 204) return null; return response.json(); } catch (error) { console.error(`Błąd API dla ${endpoint}:`, error); alert(`Wystąpił błąd: ${error.message}`); return null; } };
            const navigateTo = (hash) => { const cleanHash = hash ? hash.substring(1) : 'nowe-zamowienie'; contentSections.forEach(s => s.style.display = 'none'); const activeSection = document.getElementById(`content-${cleanHash}`); if (activeSection) activeSection.style.display = 'block'; else document.getElementById('content-nowe-zamowienie').style.display = 'block'; navLinks.forEach(l => l.classList.toggle('active', l.getAttribute('href') === `#${cleanHash}`)); if (window.innerWidth <= 800) sidebar.classList.remove('is-open'); switch(cleanHash) { case 'nowe-zamowienie': renderOrderCategories(); break; case 'zamowienia': renderOrdersHistory(); break; case 'pracownicy': renderEmployees(); break; case 'produkty': renderAllProducts(); break; } };
            const renderOrderCategories = () => { categoryListContainer.innerHTML = STATIC_CATEGORIES.map(cat => `<a class="category-tile" data-category="${cat.name}"><h3>${cat.name}</h3><span>${cat.desc || '&nbsp;'}</span></a>`).join(''); };
            const showProductsForOrdering = async (categoryName) => { /* ... cała funkcja bez zmian ... */ };
            const initializeSwipeCards = (products) => { /* ... cała funkcja bez zmian ... */ };
            const showOrderSummary = () => { /* ... cała funkcja bez zmian, ale używa `loggedInUser.login` ... */ 
                // ... wewnątrz tej funkcji, przy wysyłaniu zamówienia zmień:
                const orderData = {
                    // ...
                    orderedBy: loggedInUser.login // Użyj loginu zalogowanego użytkownika
                };
                // ...
            };
            const renderOrdersHistory = async () => { /* ... cała funkcja bez zmian ... */ };
            const renderEmployees = async () => { /* ... cała funkcja bez zmian ... */ };
            const renderAllProducts = async () => { /* ... cała funkcja bez zmian ... */ };
            const populateCategorySelects = () => { /* ... cała funkcja bez zmian ... */ };
            const setupModal = (modalId, openBtnId, formId, submitFunction) => { /* ... cała funkcja bez zmian ... */ };
            
            // Inicjalizacja i obsługa zdarzeń aplikacji
            setupModal('add-employee-modal', 'add-employee-btn', 'add-employee-form', async (form) => { /* ... */ });
            setupModal('add-product-modal', 'add-product-btn', 'add-product-form', async (form) => { /* ... */ });
            productsListContainer.addEventListener('click', async (e) => { /* ... */ });
            document.getElementById('edit-product-form').addEventListener('submit', async (e) => { /* ... */ });
            categoryListContainer.addEventListener('click', (e) => { /* ... */ });
            mainNav.addEventListener('click', (e) => { /* ... */ });
            window.addEventListener('hashchange', () => navigateTo(window.location.hash));
            menuToggleBtn.addEventListener('click', () => sidebar.classList.toggle('is-open'));
            populateCategorySelects();
            navigateTo(window.location.hash || '#nowe-zamowienie');
        };

        // LOGIKA LOGOWANIA
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorMessage.style.display = 'none';
            const login = loginInput.value;

            try {
                const userData = await apiFetch('/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ login })
                });

                if (userData) {
                    localStorage.setItem('loggedInUser', JSON.stringify(userData));
                    initializeApp(userData); // Uruchom aplikację
                }
            } catch (error) {
                errorMessage.textContent = 'Nieprawidłowy login.';
                errorMessage.style.display = 'block';
            }
        });

        // LOGIKA WYLOGOWANIA
        document.getElementById('logout-btn').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('loggedInUser');
            appView.style.display = 'none';
            loginView.style.display = 'flex';
        });

        // SPRAWDZENIE PRZY WEJŚCIU NA STRONĘ
        const storedUser = localStorage.getItem('loggedInUser');
        if (storedUser) {
            initializeApp(JSON.parse(storedUser)); // Jeśli użytkownik jest w pamięci, uruchom aplikację
        } else {
            loginView.style.display = 'flex'; // W przeciwnym razie pokaż formularz logowania
        }
    });
    </script>
</body>
</html>
