<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MilkShake System 1.0</title>
    <meta name="description" content="System do zarzdzania Twoim biznesem.">
    <meta name="theme-color" content="#0a1030">
    <link rel="icon" type="image/png" href="https://i.imgur.com/EV2m6BO.jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --accent: #ff0354; }
        html { scroll-behavior: smooth; }
        body {
            background-color: #00010f;
            background-image: radial-gradient(1200px 600px at 80% -10%, #0a1030 0%, #050919 35%, #00010f 65%, #000000 100%);
        }
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 999px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.08); }
        .active-link { background-color: var(--accent); box-shadow: 0 4px 14px rgba(255, 3, 84, 0.35); }
        .active-link:hover { filter: brightness(1.1); }
        .modal-backdrop { background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px); }
    </style>
</head>
<body class="min-h-screen text-white selection:bg-[#ff0354]/40 selection:text-white">

    <div class="flex min-h-screen">
        <aside class="w-72 flex-shrink-0 bg-black/20 border-r border-white/10 flex flex-col">
            <div class="flex items-center gap-4 p-6 border-b border-white/10">
                <img src="https://i.imgur.com/EV2m6BO.jpeg" alt="logo" class="h-12 w-12 rounded-xl ring-1 ring-white/10">
                <div class="leading-tight">
                    <div class="text-xl font-semibold tracking-tight">MilkShake System</div>
                    <div class="text-sm text-white/60">Wersja 1.0</div>
                </div>
            </div>
            
            <nav id="main-nav" class="flex-grow p-4 space-y-2">
                <a href="#dashboard" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-base font-medium transition-colors hover:bg-white/10 active-link">
                    <i data-lucide="layout-dashboard" class="h-5 w-5"></i><span>Dashboard</span>
                </a>
                <a href="#rezerwacje" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-base font-medium transition-colors hover:bg-white/10 text-white/80">
                    <i data-lucide="calendar" class="h-5 w-5"></i><span>Rezerwacje</span>
                </a>
                <a href="#pracownicy" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-base font-medium transition-colors hover:bg-white/10 text-white/80">
                    <i data-lucide="users" class="h-5 w-5"></i><span>Pracownicy</span>
                </a>
                <a href="#produkty" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-base font-medium transition-colors hover:bg-white/10 text-white/80">
                    <i data-lucide="cup-soda" class="h-5 w-5"></i><span>Produkty</span>
                </a>
            </nav>

            <div class="p-5 mt-auto border-t border-white/10">
                 <div class="flex items-center gap-3">
                    <img src="https://i.pravatar.cc/150?u=a042581f4e29026704d" alt="avatar" class="h-10 w-10 rounded-full ring-1 ring-white/10">
                    <div>
                        <div class="font-bold">Jan Kowalski</div>
                        <a href="#" class="text-xs text-white/60 hover:text-[var(--accent)] transition-colors">Wyloguj si</a>
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 p-8 overflow-y-auto">
            
            <div id="content-dashboard" class="content-section">
                <h1 class="text-3xl font-bold tracking-tight">Witaj w panelu! </h1>
                <p class="mt-2 text-white/60">Wybierz sekcj z menu po lewej stronie, aby rozpocz.</p>
            </div>

            <div id="content-rezerwacje" class="content-section hidden">
                <h1 class="text-3xl font-bold tracking-tight mb-6">Zarzdzanie rezerwacjami</h1>
                <div id="reservations-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    </div>
            </div>

            <div id="content-pracownicy" class="content-section hidden">
                 <h1 class="text-3xl font-bold tracking-tight mb-6">Lista pracownik贸w</h1>
                 <div id="employees-list" class="space-y-4">
                    </div>
            </div>

            <div id="content-produkty" class="content-section hidden">
                 <div class="flex justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold tracking-tight">Lista produkt贸w</h1>
                    <button id="add-product-btn" class="inline-flex items-center gap-2 rounded-lg bg-[var(--accent)] px-4 py-2 font-medium hover:brightness-110 transition shadow-[0_10px_30px_rgba(255,3,84,0.35)]">
                        <i data-lucide="plus" class="h-4 w-4"></i>
                        <span>Dodaj produkt</span>
                    </button>
                 </div>
                 <div id="products-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    </div>
            </div>

        </main>
    </div>

    <div id="add-product-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="bg-[#0a1030] border border-white/10 rounded-2xl shadow-xl w-full max-w-lg p-6">
            <h2 class="text-2xl font-bold mb-4">Dodaj nowy produkt</h2>
            <form id="add-product-form" class="space-y-4">
                <input type="text" name="name" placeholder="Nazwa produktu" required class="w-full bg-white/5 border border-white/10 rounded-lg p-2">
                <input type="text" name="category" placeholder="Kategoria" required class="w-full bg-white/5 border border-white/10 rounded-lg p-2">
                <input type="number" name="pricePerUnit" placeholder="Cena" step="0.01" required class="w-full bg-white/5 border border-white/10 rounded-lg p-2">
                <input type="file" name="imageFile" accept="image/*" class="w-full text-sm text-white/60 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[var(--accent)]/10 file:text-[var(--accent)] hover:file:bg-[var(--accent)]/20">
                <div class="flex justify-end gap-4 pt-4">
                    <button type="button" id="cancel-add-product" class="rounded-lg bg-white/10 px-4 py-2 text-sm font-medium hover:bg-white/20">Anuluj</button>
                    <button type="submit" class="rounded-lg bg-[var(--accent)] px-4 py-2 text-sm font-medium hover:brightness-110">Dodaj</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="edit-employee-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="bg-[#0a1030] border border-white/10 rounded-2xl shadow-xl w-full max-w-lg p-6">
            <h2 class="text-2xl font-bold mb-4">Edytuj dane pracownika</h2>
            <form id="edit-employee-form" class="space-y-4">
                <input type="hidden" id="edit-employee-id" name="id">
                <input type="text" id="edit-employee-name" name="name" placeholder="Imi i nazwisko" required class="w-full bg-white/5 border border-white/10 rounded-lg p-2">
                <input type="text" id="edit-employee-login" name="login" placeholder="Login" required class="w-full bg-white/5 border border-white/10 rounded-lg p-2">
                <div class="flex justify-end gap-4 pt-4">
                    <button type="button" id="cancel-edit-employee" class="rounded-lg bg-white/10 px-4 py-2 text-sm font-medium hover:bg-white/20">Anuluj</button>
                    <button type="submit" class="rounded-lg bg-[var(--accent)] px-4 py-2 text-sm font-medium hover:brightness-110">Zapisz zmiany</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mainNav = document.getElementById('main-nav');
            const contentSections = document.querySelectorAll('.content-section');
            const navLinks = document.querySelectorAll('.nav-link');
            
            let appData = { users: [], products: [], reservations: [], workSessions: [] };

            // --- POBIERANIE DANYCH ---
            async function fetchData() {
                try {
                    const response = await fetch('/api/data');
                    if (!response.ok) throw new Error('Bd sieci');
                    appData = await response.json();
                    navigateTo(window.location.hash || '#dashboard');
                } catch (error) {
                    console.error('Nie udao si pobra danych:', error);
                    // Mo偶na tu wywietli komunikat o bdzie
                }
            }

            // --- NAWIGACJA ---
            function navigateTo(hash) {
                const targetId = 'content-' + hash.substring(1);
                
                contentSections.forEach(section => section.classList.add('hidden'));
                const activeSection = document.getElementById(targetId);
                if (activeSection) {
                    activeSection.classList.remove('hidden');
                } else {
                    document.getElementById('content-dashboard').classList.remove('hidden');
                }

                navLinks.forEach(link => {
                    link.classList.remove('active-link', 'text-white');
                    link.classList.add('text-white/80');
                    if (link.getAttribute('href') === hash) {
                        link.classList.add('active-link', 'text-white');
                        link.classList.remove('text-white/80');
                    }
                });

                // Renderowanie widoku
                switch(hash) {
                    case '#rezerwacje': renderReservations(); break;
                    case '#pracownicy': renderEmployees(); break;
                    case '#produkty': renderProducts(); break;
                }
            }
            
            mainNav.addEventListener('click', (e) => {
                const link = e.target.closest('a');
                if (link) {
                    e.preventDefault();
                    const hash = link.getAttribute('href');
                    window.location.hash = hash;
                    navigateTo(hash);
                }
            });

            // --- RENDEROWANIE WIDOKW ---
            function renderReservations() {
                const list = document.getElementById('reservations-list');
                list.innerHTML = '';
                if(appData.reservations.length === 0) {
                    list.innerHTML = `<p class="text-white/60 col-span-full">Brak zaplanowanych rezerwacji.</p>`;
                    return;
                }
                appData.reservations.forEach(res => {
                    const card = `
                        <div class="p-4 relative rounded-xl border border-white/10 bg-white/5">
                            <h3 class="font-bold">${res.name} (${res.guests} os.)</h3>
                            <p class="text-sm text-white/70">${res.phone}</p>
                            <p class="text-sm mt-2"><span class="font-semibold">Data:</span> ${res.date} <span class="font-semibold">Godz:</span> ${res.time}</p>
                        </div>`;
                    list.innerHTML += card;
                });
            }

            function renderEmployees() {
                const list = document.getElementById('employees-list');
                list.innerHTML = '';
                 if(appData.users.length === 0) {
                    list.innerHTML = `<p class="text-white/60">Brak pracownik贸w w systemie.</p>`;
                    return;
                }
                appData.users.forEach(user => {
                    // TODO: Obliczanie godzin i zarobk贸w na podstawie `appData.workSessions`
                    const hours = '_h';
                    const earnings = '_z';
                    const card = `
                        <div class="flex items-center justify-between p-4 rounded-xl border border-white/10 bg-white/5">
                            <span class="font-bold text-lg">${user.name}</span>
                            <div class="flex items-center gap-6">
                                <span class="text-sm text-white/70">Godziny: <b class="text-white">${hours}</b></span>
                                <span class="text-sm text-white/70">Zarobki: <b class="text-white">${earnings}</b></span>
                                <button data-userid="${user._id}" data-name="${user.name}" data-login="${user.login}" class="edit-employee-btn rounded-lg bg-white/10 px-4 py-2 text-sm font-medium hover:bg-white/20">Edytuj</button>
                            </div>
                        </div>`;
                    list.innerHTML += card;
                });
                 attachEditEmployeeListeners();
            }

            function renderProducts() {
                const list = document.getElementById('products-list');
                list.innerHTML = '';
                if(appData.products.length === 0) {
                    list.innerHTML = `<p class="text-white/60 col-span-full">Brak produkt贸w w systemie.</p>`;
                    return;
                }
                appData.products.forEach(prod => {
                    const card = `
                        <div class="rounded-xl border border-white/10 bg-white/5 overflow-hidden">
                            <img src="${prod.imageUrl || 'https://via.placeholder.com/300'}" alt="${prod.name}" class="w-full h-32 object-cover">
                            <div class="p-4">
                                <h3 class="font-bold">${prod.name}</h3>
                                <p class="text-sm text-white/70">${prod.category}</p>
                                <p class="text-lg font-bold mt-2">${prod.pricePerUnit.toFixed(2)} z</p>
                            </div>
                        </div>`;
                    list.innerHTML += card;
                });
            }
            
            // --- MODALE I FORMULARZE ---

            // Modal dodawania produktu
            const addProductModal = document.getElementById('add-product-modal');
            const addProductBtn = document.getElementById('add-product-btn');
            const cancelAddProductBtn = document.getElementById('cancel-add-product');
            const addProductForm = document.getElementById('add-product-form');

            addProductBtn.addEventListener('click', () => addProductModal.style.display = 'flex');
            cancelAddProductBtn.addEventListener('click', () => addProductModal.style.display = 'none');
            
            addProductForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(addProductForm);
                try {
                    const response = await fetch('/api/products', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();
                    if(response.ok) {
                        appData.products = result.products;
                        renderProducts();
                        addProductModal.style.display = 'none';
                        addProductForm.reset();
                    } else {
                        alert('Bd: ' + result.message);
                    }
                } catch(error) {
                    console.error("Bd wysyania formularza:", error);
                }
            });

            // Modal edycji pracownika
            const editEmployeeModal = document.getElementById('edit-employee-modal');
            const cancelEditEmployeeBtn = document.getElementById('cancel-edit-employee');
            const editEmployeeForm = document.getElementById('edit-employee-form');

            function attachEditEmployeeListeners() {
                document.querySelectorAll('.edit-employee-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.getElementById('edit-employee-id').value = btn.dataset.userid;
                        document.getElementById('edit-employee-name').value = btn.dataset.name;
                        document.getElementById('edit-employee-login').value = btn.dataset.login;
                        editEmployeeModal.style.display = 'flex';
                    });
                });
            }
            
            cancelEditEmployeeBtn.addEventListener('click', () => editEmployeeModal.style.display = 'none');

            editEmployeeForm.addEventListener('submit', async(e) => {
                 e.preventDefault();
                 const id = document.getElementById('edit-employee-id').value;
                 const name = document.getElementById('edit-employee-name').value;
                 const login = document.getElementById('edit-employee-login').value;
                 
                 try {
                     const response = await fetch(`/api/users/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, login })
                     });
                     const result = await response.json();
                     if(response.ok) {
                        const userIndex = appData.users.findIndex(u => u._id === id);
                        if(userIndex !== -1) appData.users[userIndex] = result.user;
                        renderEmployees();
                        editEmployeeModal.style.display = 'none';
                     } else {
                        alert("Bd: " + result.message);
                     }
                 } catch(error) {
                    console.error("Bd aktualizacji pracownika:", error);
                 }
            });


            // --- INICJALIZACJA ---
            fetchData();
            lucide.createIcons();
        });
    </script>
</body>
</html>
